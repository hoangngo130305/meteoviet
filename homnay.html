<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hôm nay</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="homnay.css" />
</head>
<body>
  <div class="app">
    <!-- Top bar -->
    <div class="top-bar fixed-bar">
      <div class="menu-icon">☰</div>
      <div class="title" id="location-name">Địa phương</div>
      <div></div>
    </div>

    <!-- Header -->
    <div class="header header-with-bg">
      <div class="location">
        <div class="summary-left">
          <p class="summary-time">--:--</p>
          <div class="summary-weather">
            <img id="weather-icon" src="" alt="icon" style="width: 24px; vertical-align: middle;" />
            <span id="weather-text">Đang tải...</span>
          </div>
        </div>
        <button class="button-1">
          <div class="zalo-follow">+ Follow Zalo OA</div>
        </button>
      </div>

      <!-- Nội dung thời tiết -->
      <div class="section weather-body">
        <!-- UV -->
        <div class="card uv-card">
          <p class="label">Chỉ số UV:</p>
          <div class="uv-value">
            <img src="img/sun.png" alt="UV icon" />
            <span id="uv">--</span>
          </div>
          <div class="uv-detail">
            <div class="uv-box">Mức phơi nhiễm hiện tại:<br /><strong>--</strong></div>
            <div class="uv-box">Chỉ số UV tối đa hôm nay:<br /><strong>--</strong></div>
          </div>
        </div>
      </div>

      <!-- Cảm nhận & Độ ẩm -->
      <div class="row">
        <div class="card small">
          <div class="label-with-icon">
            <p class="label">Cảm nhận</p>
            <div class="icon-circle"><i class="fa-solid fa-thermometer"></i></div>
          </div>
          <p class="value" id="feelslike">--</p>
        </div>

        <div class="card small">
          <div class="label-with-icon">
            <p class="label">Độ ẩm</p>
            <div class="icon-circle"><i class="fa-solid fa-droplet"></i></div>
          </div>
          <p class="value" id="humidity">--</p>
        </div>
      </div>

      <!-- Gió -->
      <div class="info-row wind-section">
        <div class="wind-details">
          <div class="section-title">Gió</div>
          <div class="wind-info">
            <div class="wind-item"><span>Gió</span><span class="wind-value" id="wind-speed">--</span></div>
            <hr />
            <div class="wind-item"><span>Gió giật</span><span class="wind-value" id="wind-gust">--</span></div>
            <hr />
            <div class="wind-item"><span>Hướng gió</span><span class="wind-value" id="wind-dir">--</span></div>
          </div>
        </div>
        <div class="wind-speed">
          <div class="wind-icon"><i class="fa-solid fa-wind"></i></div>
          <div class="compass">
            <div class="direction n">N</div>
            <div class="direction s">S</div>
            <div class="direction w">W</div>
            <div class="direction e">E</div>
            <div class="center-speed" id="wind-center">--<br><span>km/h</span></div>
            <div class="arrow" style="transform: rotate(150deg)"></div>
          </div>
        </div>
      </div>

      <!-- Các chỉ số khác -->
      <div class="row">
        <div class="card small">
          <div class="label-with-icon">
            <p class="label">Chất lượng không khí</p>
            <div class="icon-circle"><i class="fa-solid fa-smog"></i></div>
          </div>
          <p class="value" id="air-quality">--</p>
        </div>

        <div class="card small">
          <div class="label-with-icon">
            <p class="label">Lượng mưa</p>
            <div class="icon-circle"><i class="fa-solid fa-cloud-rain"></i></div>
          </div>
          <p class="value" id="rain">--</p>
        </div>
      </div>

      <div class="row">
        <div class="card small">
          <div class="label-with-icon">
            <p class="label">Mây che phủ</p>
            <div class="icon-circle"><i class="fa-solid fa-cloud"></i></div>
          </div>
          <p class="value" id="cloud">--</p>
        </div>

        <div class="card small">
          <div class="label-with-icon">
            <p class="label">Tầm nhìn</p>
            <div class="icon-circle"><i class="fa-solid fa-eye"></i></div>
          </div>
          <p class="value" id="visibility">--</p>
        </div>
      </div>
    </div>

    <!-- Bottom nav -->
    <div class="bottom-nav">
      <div class="nav-item"><i class="fa-solid fa-calendar-days"></i><a href="index.html"><div class="active">Hôm nay</div></a></div>
      <div class="nav-item"><i class="fa-solid fa-clock"></i><a href="homnay2.html"><div>Theo giờ</div></a></div>
      <div class="nav-item"><i class="fa-solid fa-calendar-day"></i><a href="hangngay.html"><div>Hằng ngày</div></a></div>
      <div class="nav-item"><i class="fa-solid fa-chart-simple"></i><a href="thuyvan.html"><div>Thủy văn</div></a></div>
      <div class="nav-item"><i class="fa-solid fa-calendar-minus"></i><a href="licham.html"><div>Lịch âm</div></a></div>
    </div>
  </div>

  <script>
    const API = "http://127.0.0.1:8000/api";
    const wardId = localStorage.getItem("selectedWardId");

    if (wardId) {
      fetch(`${API}/weather/?ward_id=${wardId}`)
        .then(res => res.json())
        .then(data => {
          if (!data || !data.current || !data.forecast || !data.forecast.forecastday) {
            alert("Không thể lấy dữ liệu thời tiết.");
            return;
          }

          const current = data.current;
          const forecast = data.forecast.forecastday[0];
          const condition = current.condition || {};

          document.getElementById("location-name").textContent = data.location?.name || "Địa phương";
          document.querySelector(".summary-time").textContent = new Date().toLocaleString("vi-VN");
          document.getElementById("weather-icon").src = "https:" + condition.icon;
          document.getElementById("weather-text").textContent = condition.text || "Không rõ";

          document.getElementById("uv").textContent = current.uv;
          document.getElementById("feelslike").textContent = current.feelslike_c + "°";
          document.getElementById("humidity").textContent = current.humidity + "%";
          document.getElementById("air-quality").innerHTML = (current.air_quality?.pm2_5 || "--") + " <span>Tốt</span>";
          document.getElementById("rain").textContent = forecast.day.totalprecip_mm + " mm";
          document.getElementById("cloud").textContent = forecast.day.daily_chance_of_rain + "%";
          document.getElementById("visibility").textContent = forecast.day.avgvis_km + " km";

          document.getElementById("wind-speed").textContent = current.wind_kph + " km/h";
          document.getElementById("wind-gust").textContent = current.gust_kph + " km/h";
          document.getElementById("wind-dir").textContent = current.wind_dir;
          document.getElementById("wind-center").innerHTML = `${current.wind_kph}<br><span>km/h</span>`;
        })
        .catch(err => console.error("Lỗi khi lấy thời tiết:", err));
    } else {
      alert("Vui lòng chọn tỉnh/huyện/xã ở trang chủ trước.");
    }
  </script>
</body>
</html>
