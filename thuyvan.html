<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thời tiết - Meteo Việt</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <link rel="stylesheet" href="thuyvan.css" />
  </head>
  <body>
    <div class="app">
      <div class="top-bar fixed-bar">
        <div class="menu-icon">☰</div>
        <div class="title">HỒ CHÍ MINH</div>
        <!-- <button class="btn-licham hidden">Lịch âm</button> -->
      </div>

      <div class="headerr">
        <p class="today">Hôm nay, ngày 23 tháng 4 (dương lịch)</p>
        <p class="today lunar">nhằm ngày 22 tháng 3 (âm lịch)</p>
        <p class="status">Tình trạng hiện tại</p>
      </div>

      <div class="tide-box">
        <!-- Hàng tiêu đề -->
        <div class="tide-header">
          <div class="tide-title">
            <i class="fa-solid fa-arrow-up"></i> Đỉnh triều
          </div>
          <div class="tide-title">
            <i class="fa-solid fa-arrow-down"></i> Chân triều
          </div>
        </div>

        <!-- Hàng dữ liệu -->
        <div class="tide-grid">
          <div class="tide-col">
            <p class="label">Mực nước</p>
            <p class="value red">1,6</p>
            <p class="time">19:00</p>
          </div>
          <div class="tide-col">
            <p class="label">Mực nước</p>
            <p class="value blue">1,34</p>
            <p class="time">08:30</p>
          </div>
          <div class="tide-col">
            <p class="label">Mực nước</p>
            <p class="value black">-1,18</p>
            <p class="time">19:00</p>
          </div>
          <div class="tide-col">
            <p class="label">Mực nước</p>
            <p class="value bold">0,29</p>
            <p class="time">19:00</p>
          </div>
        </div>
      </div>

      <!-- Chart -->
      <div class="chart-box">
        <h5>Dự báo thủy triều</h5>
        <div class="chart-container" style="position: relative">
          <canvas id="tideChart" height="250"></canvas>
        </div>
      </div>

      <!-- Hệ số -->
      <div class="info-box">
        <h5><i class="fa-regular fa-circle-question"></i> Hệ số thủy triều</h5>
        <p class="desc">
          Hệ số thủy triều cho chúng ta biết biên độ của dự báo thủy triều
          (chênh lệch về chiều cao giữa các mức thủy triều cao và thấp liên tiếp
          ở bất kỳ khu vực nào trước đó).
        </p>
        <ul class="legend">
          <li>
            <span class="dot black"></span> Bình thường
            <span class="level">> 1,0m</span>
          </li>
          <li>
            <span class="dot green"></span> Báo động I
            <span class="level">> 1,40m</span>
          </li>
          <li>
            <span class="dot orange"></span> Báo động II
            <span class="level">> 1,50m</span>
          </li>
          <li>
            <span class="dot red"></span> Báo động III
            <span class="level">> 1,60m</span>
          </li>
        </ul>
      </div>

      <!-- Footer -->
      <div class="footer-bar">
        <div class="footer-left">
          <i class="fa-solid fa-map icon"></i>
          <span class="label">Nhabe</span>
        </div>

        <div class="footer-right">
          <i class="fa-solid fa-chevron-down arrow"></i>
          <div class="footer-separator"></div>
          <span class="label">23/04/2025</span>
          <i class="fa-solid fa-chevron-down arrow"></i>
        </div>
      </div>

      <div class="bottom-nav">
        <div class="nav-item">
          <i class="fa-solid fa-calendar-days"></i>
          <a href="index.html"><div>Hôm nay</div></a>
        </div>
        <div class="nav-item">
          <i class="fa-solid fa-clock"></i>
          <a href="homnay2.html"><div>Theo giờ</div></a>
        </div>
        <div class="nav-item">
          <i class="fa-solid fa-calendar-day"></i>
          <a href="hangngay.html"><div>Hằng ngày</div></a>
        </div>
        <div class="nav-item">
          <i class="fa-solid fa-chart-simple"></i>
          <a href="thuyvan.html"><div>Thủy văn</div></a>
        </div>
        <div class="nav-item">
          <i class="fa-solid fa-calendar-minus"></i>
          <a href="licham.html"><div>Lịch âm</div></a>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const ctx = document.getElementById("tideChart").getContext("2d");

      function createGradient(ctx) {
        const gradient = ctx.createLinearGradient(0, 0, 0, 250);
        gradient.addColorStop(0, "#e0f0ff");
        gradient.addColorStop(1, "#2e7cf6");
        return gradient;
      }

      const tideData = {
        labels: [
          "0h",
          "2h",
          "4h",
          "6h",
          "8h",
          "10h",
          "12h",
          "14h",
          "16h",
          "18h",
          "20h",
          "22h",
          "0h",
        ],
        datasets: [
          {
            label: "Mực nước (m)",
            data: [
              1.8, 2.5, 4.2, 3.0, 2.1, 1.3, 2.8, 3.0, 2.5, 2.1, 1.5, 1.1, 1.9,
            ],
            borderColor: "#2e7cf6",
            backgroundColor: createGradient(ctx),
            fill: true,
            tension: 0.4,
            pointBackgroundColor: "#ff4c4c",
            pointRadius: 5,
          },
        ],
      };

      new Chart(ctx, {
        type: "line",
        data: tideData,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              min: 0,
              max: 5,
              title: {
                display: true,
                text: "m", // Đơn vị hiển thị một lần ở đầu trục y
                align: "start", // Hiển thị ở phía trên
                color: "#333",
                font: {
                  size: 13,
                  weight: "bold",
                },
              },
              ticks: {
                stepSize: 1,
                padding: 5,
                color: "#444",
                font: {
                  size: 12,
                },
              },
              grid: {
                display: false, // ❌ ẩn gạch ngang
              },
            },
            x: {
              grid: {
                display: false,
              },
              ticks: {
                color: "#444",
                font: {
                  size: 12,
                },
              },
            },
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              enabled: false,
              external: function (context) {
                const { chart, tooltip } = context;
                const tooltipEl = getOrCreateTooltip(chart);

                if (tooltip.opacity === 0) {
                  tooltipEl.style.opacity = 0;
                  return;
                }

                if (tooltip.body) {
                  const dataPoint = tooltip.dataPoints[0];
                  tooltipEl.innerHTML = `<div class="tooltip-label">${dataPoint.label}</div>`;
                }

                const { offsetLeft: positionX, offsetTop: positionY } =
                  chart.canvas;

                tooltipEl.style.opacity = 1;
                tooltipEl.style.left = positionX + tooltip.caretX - 20 + "px";
                tooltipEl.style.top = positionY + tooltip.caretY - 35 + "px";
              },
            },
          },
        },
      });

      function getOrCreateTooltip(chart) {
        let tooltipEl = chart.canvas.parentNode.querySelector(".chart-tooltip");

        if (!tooltipEl) {
          tooltipEl = document.createElement("div");
          tooltipEl.classList.add("chart-tooltip");
          chart.canvas.parentNode.appendChild(tooltipEl);
        }

        return tooltipEl;
      }

      const currentPath = window.location.pathname.split("/").pop();

      document.querySelectorAll(".bottom-nav .nav-item").forEach((item) => {
        const link = item.querySelector("a");
        const href = link.getAttribute("href").split("/").pop();

        if (
          currentPath === href ||
          (currentPath === "" && href === "index.html")
        ) {
          item.classList.add("active");
        }
      });
    </script>
  </body>
</html>
